trigger:
- ci-tools-azure

resources:
  containers:
  - container: openjdk
    image: openjdk:11.0.3-jdk-stretch
  - container: postgres
    image: postgres:12-alpine
    options: --env POSTGRES_USER=postgres --env POSTGRES_PASSWORD=postgres --env POSTGRES_DB=circle_test  --env POSTGRES_HOST_AUTH_METHOD=trust
    ports:
    - 5432

jobs:
  - job: Build_and_Test
    dependsOn: Build
    pool:
      vmImage: 'ubuntu-latest'
    container: openjdk
    services:
      postgres: postgres
      steps:
        - task: Gradle@2
          inputs:
            workingDirectory: ''
            gradleWrapperFile: 'gradlew'
            gradleOptions: '-Xmx3072m'
            javaHomeOption: 'JDKVersion'
            jdkVersionOption: '1.11'
            jdkArchitectureOption: 'x64'
            publishJUnitResults: true
            testResultsFiles: '**/TEST-*.xml'
            tasks: 'test'
            options: '--tests com.circleci.demojavaspring.postgres.*Test'
            codeCoverageToolOption: 'jaCoCo'
        - bash: ./gradlew assemble
